<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zayan AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"> <!-- Bootstrap Icons -->

    <style>
        /* CSS Styles (Combined and Minified) */
        .ai-response a {
            color: blue;
            text-decoration: underline;
        }

        .ai-response a:hover {
            text-decoration: none;
        }

        .custom-input {
            outline: none;
            border: none;
        }

        .size-6 {
            width: 1.15rem;
            height: 1.5rem;
        }

        /* Removed .refresh-button styles */

        .animated-border-shadow {
            border: none;
            position: relative;
            transition: box-shadow: 0.3s ease;
        }

        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 7;
            height: 2.5rem;
            padding-left: 0.5rem;
            padding-right: 0.5rem;

        }

        .fixed-input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 0.5rem;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            background-color: white;
        }

        .chat-container-wrapper {
            overflow-y: auto;
            padding-bottom: 8rem;
        }

        #user-input {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            padding-left: 0px;
        }

        #chat-container>div:last-child {
            margin-bottom: 1rem;
        }

        .message-content {
            max-width: 80%;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 1px;
            transition: transform 0.5s linear;
        }

        .avatar.rotate {
            animation: rotate 1s linear infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .ai-message-container {
            display: flex;
            align-items: flex-start;
        }

        .ai-response.no-bottom-left-radius {
            border-bottom-left-radius: 0;
        }

        #chat-container {
            width: 95%;
            max-width: 960px;
        }

        .menu-button {
            padding: 0.5rem;
            cursor: pointer;
        }

        body {
            padding-top: 2.5rem;
            height: 100vh;
        }

        .generated-image-container {
            margin-bottom: 1rem;
            text-align: center;
        }

        .generated-image {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            border: 2px solid #ddd;
        }

        body {
            background-color: white;
            color: black;
        }

        .fixed-header {
            background-color: white;
        }

        .animated-border-shadow {
            box-shadow: 0 0 8px 2px rgba(0, 0, 0, 0.15);
            background-color: white;
        }

        .animated-border-shadow:hover {
            box-shadow: 0 0 8px 2px rgba(0, 0, 0, 0.3);
        }

        .user-message {
            background-color: white;
            color: black;
            border-radius: 5px 5px 0px 5px;
            margin-right: 0px;
            border-color: #0091ea;
            border: 1px solid gray;
        }

        .ai-response {
            background-color: #fff;
            color: #000;
            border-radius: 20px 20px 20px 0px;
            font-family: fantasy;
            /*  Set font to Arial */
            padding: 0.5rem 1rem;
            /* Add padding */
            max-width: 80%;
            /* add this line */
            word-wrap: break-word;
            /* add this line */
        }

        .menu-button,
        #send-button {
            color: black;
        }

        .ai-image-container {
            border-radius: 20px 20px 20px 0px;
            overflow: hidden;
        }

        .ai-image-container img {
            display: block;
            width: 100%;
            height: auto;
        }

        .ai-image-description {
            padding: 10px;
            font-size: 14px;
        }
        .ai-video-description {
            padding: 10px;
            font-size: 14px;
        }
        .input-footer-text {
            font-size: 0.75rem;
            color: black;
            text-align: center;
            margin-top: 0.25rem;
        }

        .input-container {
            width: 95%;
            max-width: 960px;
        }

        .thinking-indicator {
            font-style: fantasy;
            /*  Make the thinking indicator italic */
            color: gray;
            /*  Use a gray color */
            margin-left: 10px;
        }

        .gap-between-chat-and-input {
            margin-bottom: 1rem;
        }

        .suggestion-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .suggestion-image {
            width: 4rem;
            height: 4rem;
            margin-bottom: 0.5rem;
        }

        #suggestion-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            overflow-x: auto;
            justify-content: center;
        }

        #suggestion-list button {
            background-color: white;
            color: black;
            border: 1px solid gray;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.875rem;
        }

        .suggestion-header {
            text-align: center;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            color: black;
            font-weight: bold;
        }

        .suggestion-container.hidden {
            display: none;
        }

        /* Removed .copy-button and related styles */

        /* Style for the 'h' button glow */
        #h {
            position: relative;
            overflow: hidden;
        }

        #h.active::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            width: calc(100% + 20px);
            height: calc(100% + 20px);
            background: radial-gradient(circle, rgba(0, 149, 255, 0.7) 0%, transparent 70%);
            border-radius: 50%;
            opacity: 1;
            z-index: 0;
            animation: glowAnimation 1s ease-out;
        }

        #h.inactive::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            width: calc(100% + 20px);
            height: calc(100% + 20px);
            background: radial-gradient(circle, rgba(0, 149, 255, 0.7) 0%, transparent 0%);
            border-radius: 50%;
            opacity: 0;
            z-index: 0;
        }

        @keyframes glowAnimation {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        #h.active::before {
            animation-play-state: running;
        }

        #h.inactive::before {
            animation-play-state: paused;
        }


        #h {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 1px solid black;
            box-shadow: 0px 0px 1px rgba(0, 0, 0, 0.3);
            background-color: white;
            color: black;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        #h.active {
            border: 2px solid blue;
            box-shadow: 0 0 0 3px rgba(0, 0, 255, 0.3);
        }
        
                #senh {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            border-radius: 100%;
            border: 1px solid black;
box-shadow: 0px 0px 1px rgba(0, 0, 0, 0.3);
            background-color: white;
            color: black;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
            #voice-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 1px solid black;
            box-shadow: 0px 0px 1px rgba(0, 0, 0, 0.3);
            background-color: white;
            color: black;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        /*  Bootstrap Icons specific styling */
        .input-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            
            background-color: white;
            
            color: black;
            
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }


         /*  Adjust for icon size and positioning */
         #send-button i {
            font-size: 1.88rem; /* Adjust icon size as needed */
        }
        #senh i, #voice-button i{
            font-size: 1.45rem; /* Adjust icon size as needed */
        }
                #senh i{
            font-size: 1.15rem; /* Adjust icon size as needed */
        }
    </style>

</head>

<body class="bg-white flex flex-col">

    <div class="fixed-header flex items-center justify-between" id="header">
        <button class="menu-button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c-.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
            </svg>
        </button>

        <h1 class="text-black text-xl font-semibold text-center flex-grow">Zαყαɳ AI</h1>

        <button class="m3-button" id="newchat">
            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="15.000000pt" height="15.000000pt"
                viewBox="0 0 104.000000 100.000000" preserveAspectRatio="xMidYMid meet">
                <g transform="translate(0.000000,100.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
                    <path
                        d="M735 955 c-16 -7 -111 -94 -211 -192 -217 -213 -225 -228 -232 -381 l-5 -104 109 4 c159 6 170 12 389 230 159 159 185 189 195 228 15 57 8 103 -25 152 -45 68 -147 97 -220 63z m113 -111 c15 -10 22 -25 22 -47 0 -29 -21 -53 -177 -209 -126 -125 -187 -178 -208 -183 -80 -17 -75 -18 -75 16 0 17 7 45 15 63 22 46 356 376 381 376 11 0 30 -7 42 -16z" />
                    <path
                        d="M143 885 c-27 -16 -49 -40 -62 -68 -20 -41 -21 -60 -21 -328 0 -156 5 -300 10 -319 11 -41 61 -94 103 -109 18 -7 140 -11 323 -11 320 0 335 2 386 56 41 44 48 75 48 215 l0 129 -60 0 -60 0 0 -130 c0 -126 -1 -130 -24 -145 -21 -14 -62 -15 -298 -13 -215 2 -279 6 -291 17 -15 12 -17 46 -17 302 0 348 -15 319 167 319 l123 0 0 55 0 55 -142 0 c-135 0 -145 -2 -185 -25z" />
                </g>
            </svg>
        </button>
    </div>

    <div class="flex flex-col items-center flex-grow">

        <div id="error" class="text-red-500 text-center mb-4 hidden"></div>
        <div id="generatedImagesContainer" class="mt-4"></div>

        <div class="chat-container-wrapper w-full flex flex-col items-center gap-between-chat-and-input">
            <div id="chat-container" class="flex flex-col mt-4"></div>
        </div>

        <div class="fixed-input-container">
            <div class="suggestion-container hidden">
                <img src="https://assets.onecompiler.app/43322xfez/435cdphmc/1000018777.png" alt="Logo"
                    class="suggestion-image">
                <div class="suggestion-header">
                    How can I help you today?
                </div>
                <div id="suggestion-list" role="listbox"></div>
            </div>
            <div
                class="no-focus-highlight bg-white rounded-3xl p-3 space-y-2 transition-all duration-300 animated-border-shadow input-container">

                <input type="text" id="user-input" placeholder="Ask Zαყαɳ AI "
                    class="border-none bg-transparent focus:ring-0 focus:ring-offset-0 text-lg placeholder-gray-600 w-full custom-input"
                    style="padding-top: 0.25rem; padding-bottom: 0.25rem; padding-left: 0px;" />

                <div class="flex items-end justify-end gap-4">
                  <button id="senh" class="input-button transition">
                        <i class="bi bi-paperclip"></i>
                  </button>
                   <button id="h" class="input-button">
<i class="bi bi-globe"></i>
                    </button>

                    <button id="voice-button" class="input-button transition">
                    <i class="bi bi-soundwave"></i>
                    </button>

                    <button id="send-button" class="input-button transition" >
<i class="bi bi-arrow-up-circle-fill"></i>
                    </button>
                </div>
            </div>
            <p class="input-footer-text">Zayan AI-Triple AI Fusion Technology</p>
        </div>
    </div>
</body>

</html>

    <script>
const chatContainer = document.getElementById('chat-container');
const userInput = document.getElementById('user-input');
const sendButton = document.getElementById('send-button');
const voiceButton = document.getElementById('voice-button');
const botAvatarUrl = "https://assets.onecompiler.app/4398w3ppx/43bsja34j/1000018777.png";  //  Or your actual avatar
const errorDiv = document.getElementById('error');
const generatedImagesContainer = document.getElementById('generatedImagesContainer');
const newChatButton = document.getElementById('newchat');
const suggestionList = document.getElementById('suggestion-list');
const suggestionContainer = document.querySelector('.suggestion-container');

// Default Chatbot - Samar ai
let chatbotName = "Samar ai";
let username = "da_564";
const vectorShiftApiKey = "sk_2ngCc847cbWLPmLUTVrfqnVg9Wk79YRo3gqQHKkz2jqkYVDF";  // Primary API Key.

const pexelsApiKey = "IpBPfHmCoj28Y9Zgk9AaLxc9lYZmaJ5y7CwwbZq7wpsbaV3WddRTQVeS";
const secondVectorShiftApiKey = "sk_TfH0501pnMxcOtflFBToXnqifTGfeBxDrUoUajbTWHFAEreI"; // New API key for the SECOND api call.

let conversationId = null;
let thinkingIndicator = null;
let usedVideoIds = new Set();
let usedImageIds = new Set(); // Keep track of used image IDs as well
let currentPexelsVideoPage = 1;
let currentPexelsImagePage = 1; // Track page for images
const videosPerPage = 30;
const imagesPerPage = 30; // Or whatever is appropriate for images
let useSecondApi = false; // Flag to indicate if the second API should be used.

// Add a variable to store a reference to the 'h' button
const hButton = document.getElementById('h'); // Your button with id="h"

function loadSuggestions(suggestions = []) {
    suggestionList.innerHTML = '';

    if (suggestions.length === 0) {
        suggestions = [
            "Generate HTML code for website.",
            "Generate image of Moon.",
            "Search video of a Robot.",
            "I want to enhance pictures. "
        ];
    }

    suggestions.forEach(suggestion => {
        const button = document.createElement('button');
        button.textContent = suggestion;
        button.setAttribute('aria-label', `Suggest ${suggestion}`);
        button.setAttribute('role', 'option');
        button.addEventListener('click', () => {
            userInput.value = suggestion;
            sendButton.click();
            hideSuggestions(); // Hide after suggestion is clicked
        });
        suggestionList.appendChild(button);
    });

    suggestionContainer.classList.remove('hidden'); // Show the container
}

function hideSuggestions() {
    suggestionContainer.classList.add('hidden');
}

function addMessage(message, isUser, imageSrc = null, iframeSrc = null) {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('flex', 'mb-2');

    if (isUser) {
        messageDiv.classList.add('justify-end');
    } else {
        messageDiv.classList.add('justify-start', 'ai-message-container');
    }

    if (!isUser) {
        const avatarImg = document.createElement('img');
        avatarImg.src = botAvatarUrl;
        avatarImg.alt = "Bot Avatar";
        avatarImg.classList.add('avatar');
        messageDiv.appendChild(avatarImg);
    }

    const messageContent = document.createElement('div');
    messageContent.classList.add(
        'rounded-xl',
        'px-4',
        'py-2',
        'text-sm',
        'message-content',
        isUser ? 'user-message' : 'ai-response'
    );

    // Create a container for the AI response and copy button
    const responseContainer = document.createElement('div');
    responseContainer.style.display = 'flex';
    responseContainer.style.flexDirection = 'column'; // Stack children vertically


    if (iframeSrc && !isUser) {
        const iframe = document.createElement('iframe');
        iframe.src = iframeSrc;
        iframe.width = "300px";
        iframe.height = "350px";
        iframe.allow = "clipboard-read; clipboard-write; microphone";
        iframe.style.border = "2px solid black";
        iframe.style.borderRadius = "10%";
        responseContainer.appendChild(iframe);  // Append to responseContainer
    } else if (imageSrc && !isUser) {
        const imgElement = document.createElement('img');
        imgElement.src = imageSrc;
        imgElement.alt = "Uploaded Image";
        imgElement.classList.add('generated-image');
        responseContainer.appendChild(imgElement); // Append to responseContainer

        const textDiv = document.createElement('div');
        textDiv.innerHTML = marked.parse(message);
        responseContainer.appendChild(textDiv); // Append to responseContainer

    } else if (!isUser) {
        const codeRegex = /```([\w-]+)?\n([\s\S]*?)\n```/g;
        let match;
        if ((match = codeRegex.exec(message)) !== null) {
            let language = match[1] || 'plaintext';
            let code = match[2];
            const pre = document.createElement('pre');
            const codeElement = document.createElement('code');
            codeElement.className = `language-${language}`;
            codeElement.textContent = code;
            pre.appendChild(codeElement);

            // Add copy button to code block
            const copyCodeButton = document.createElement('button');
            copyCodeButton.classList.add('copy-button');
            copyCodeButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>';
            copyCodeButton.setAttribute('aria-label', 'Copy code to clipboard');
            copyCodeButton.style.position = 'absolute'; // Position absolutely within the pre
            copyCodeButton.style.top = '0.5rem';
            copyCodeButton.style.right = '0.5rem';
            copyCodeButton.style.padding = '0.25rem';
            copyCodeButton.style.display = 'none';  // Initially hidden

            copyCodeButton.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent triggering pre's click event
                navigator.clipboard.writeText(code).then(() => {
                    copyCodeButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><polyline points="20 6 9 17 4 12"/></svg>';
                    setTimeout(() => {
                        copyCodeButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>';
                    }, 2000);
                }).catch(err => console.error('Failed to copy code: ', err));
            });

            pre.style.position = 'relative'; // Make pre a positioning context
            pre.appendChild(copyCodeButton);

            // Show/hide copy button on pre click
            pre.addEventListener('click', () => {
                copyCodeButton.style.display = copyCodeButton.style.display === 'none' ? 'block' : 'none';
            });

            const parsedMessage = marked.parse(message.replace(codeRegex, ''));
            const messageTextDiv = document.createElement('div');
            messageTextDiv.innerHTML = parsedMessage;

            responseContainer.appendChild(messageTextDiv); // Add parsed message first
            responseContainer.appendChild(pre);  // Append pre (code block)
            hljs.highlightElement(codeElement);
        } else {
            const textDiv = document.createElement('div');
            textDiv.innerHTML = marked.parse(message);
             responseContainer.appendChild(textDiv); // Append to responseContainer
        }
        //Add copy button for AI response text
        const copyButton = document.createElement('button');
        copyButton.classList.add('copy-button');
        // Smaller SVG and button
        copyButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>'; // Copy icon SVG
        copyButton.setAttribute('aria-label', 'Copy to clipboard');
        copyButton.style.marginTop = '0.5rem'; // Add some space above the button
        copyButton.style.alignSelf = 'flex-start'; // Align to the start (left)
        copyButton.style.padding = '0.25rem'; // Reduce padding.  Important!


        copyButton.addEventListener('click', () => {
            const textToCopy = message; // Copy the original message
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Optional: Show "Copied!" message or change the icon briefly
                copyButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><polyline points="20 6 9 17 4 12"/></svg>';
                setTimeout(() => {
                    copyButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>'; // Copy icon SVG
                }, 2000); // Reset after 2 seconds

            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        });
        responseContainer.appendChild(copyButton); // Append copy button *after* content

    } else {
        messageContent.textContent = message;
    }


    // Add copy button for AI responses only if it is a text response
    if (!isUser && !imageSrc && !iframeSrc) {
          messageContent.appendChild(responseContainer);  // Append responseContainer
    } else {
        messageContent.appendChild(responseContainer); // Append directly if user message
    }


    messageDiv.appendChild(messageContent);
    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}



function showThinkingIndicator() {
    if (thinkingIndicator && thinkingIndicator.parentNode) {
        return;
    }

    thinkingIndicator = document.createElement('div');
    thinkingIndicator.classList.add('flex', 'mb-2', 'justify-start', 'ai-message-container');

    const avatarImg = document.createElement('img');
    avatarImg.src = botAvatarUrl;
    avatarImg.alt = "Bot Avatar";
    avatarImg.classList.add('avatar', 'rotate'); // Add rotate class for animation
    thinkingIndicator.appendChild(avatarImg);

    const thinkingText = document.createElement('span');
    thinkingText.textContent = 'Thinking...';
    thinkingText.classList.add('thinking-indicator');
    thinkingIndicator.appendChild(thinkingText);

    chatContainer.appendChild(thinkingIndicator);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

function removeThinkingIndicator() {
    if (thinkingIndicator && thinkingIndicator.parentNode) {
        thinkingIndicator.parentNode.removeChild(thinkingIndicator);
        thinkingIndicator = null;
    }
}

// This function is only used by the sendButton
async function getVectorShiftResponse(prompt) {
    try {
        const bodyData = {
            input: prompt,
            chatbot_name: chatbotName, // Use the current chatbot name (Samar ai)
            username: username, // Use the current username (da_564)
            conversation_id: conversationId,
        };

        const response = await fetch("https://api.vectorshift.ai/api/chatbots/run", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Api-Key": vectorShiftApiKey,  // Use Primary Key
            },
            body: JSON.stringify(bodyData),
        });

        if (!response.ok) {
            const errorData = await response.json();
            console.error("VectorShift API Error:", response.status, errorData);
            throw new Error(`VectorShift API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
        }

        const data = await response.json();

        if (data.conversation_id) {
            conversationId = data.conversation_id;
        }

        if (data.output) {
            return data.output;
        } else {
            throw new Error("Unexpected response format from VectorShift API.");
        }

    } catch (error) {
        console.error("Error getting VectorShift response:", error);
        addMessage(`Failed to get response: ${error.message}`, false);
        return null;
    }
}

async function searchPexelsVideos(query) {
    try {
        showThinkingIndicator(); // Show thinking indicator *before* the API call

        let videoUrl = null;
        let videoAlt = null;

        while (!videoUrl) {
            const response = await fetch(
                `https://api.pexels.com/videos/search?query=${encodeURIComponent(query)}&per_page=${videosPerPage}&page=${currentPexelsVideoPage}`,
                { method: "GET", headers: { Authorization: pexelsApiKey } }
            );

            if (!response.ok) {
                throw new Error(`Pexels API error! Status: ${response.status}, Message: ${await response.text()}`);
            }

            const data = await response.json();
            if (data.videos.length === 0) {
                if (currentPexelsVideoPage === 1) {
                    addMessage(`No videos found for "${query}". Try again.`, false);
                    return;
                }
                currentPexelsVideoPage = 1;
                continue;
            }
            for (const video of data.videos) {
                if (!usedVideoIds.has(video.id)) {
                    const videoFile = video.video_files.find(file => file.file_type === "video/mp4" && file.quality === "hd") ||
                        video.video_files.find(file => file.file_type === "video/mp4");

                    if (videoFile) {
                        videoUrl = videoFile.link;
                        videoAlt = video.url || "Video from Pexels";
                        usedVideoIds.add(video.id);
                        break;
                    }
                }
            }

            if (!videoUrl) currentPexelsVideoPage++;

            if (data.next_page === undefined && !videoUrl) {
                addMessage(`No videos found for "${query}". Try again.`, false);
                return;
            }

        }

        const messageDiv = document.createElement('div');
        messageDiv.classList.add('flex', 'mb-2', 'justify-start', 'ai-message-container');

        const avatarImg = document.createElement('img');
        avatarImg.src = botAvatarUrl;
        avatarImg.alt = "Bot Avatar";
        avatarImg.classList.add('avatar');
        messageDiv.appendChild(avatarImg);

        const videoContainer = document.createElement('div');
        videoContainer.classList.add('ai-response', 'ai-video-container');

        const videoElement = document.createElement('video');
        videoElement.src = videoUrl;
        videoElement.alt = videoAlt;
        videoElement.controls = true;
        videoElement.classList.add('generated-video');
        videoElement.style.maxWidth = '100%';
        videoElement.style.height = 'auto';
        videoElement.onerror = () => {
            addMessage(`Error loading video for "${query}". Please try a different query.`, false);
        };

        videoContainer.appendChild(videoElement);

        const description = document.createElement('div');
        description.classList.add('ai-video-description');
        description.textContent = `Here's a video based on "${query}".`;
        videoContainer.appendChild(description);

        messageDiv.appendChild(videoContainer);
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;

    } catch (error) {
        console.error("Error searching Pexels videos:", error);
        addMessage(`Failed to search for videos: ${error.message}. Please try again.`, false);
    } finally {
        removeThinkingIndicator(); // Remove thinking indicator *after* the API call (success or failure)
    }
}

// Function to search for images on Pexels
async function searchPexelsImages(query) {
    try {
        showThinkingIndicator();

        let imageUrl = null;
        let imageAlt = null;

        while (!imageUrl) {
            const response = await fetch(
                `https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&per_page=${imagesPerPage}&page=${currentPexelsImagePage}`,
                { method: "GET", headers: { Authorization: pexelsApiKey } }
            );

            if (!response.ok) {
                throw new Error(`Pexels API error! Status: ${response.status}, Message: ${await response.text()}`);
            }

            const data = await response.json();

            if (data.photos.length === 0) {
               if(currentPexelsImagePage === 1) {
                    addMessage(`No images found for "${query}". Try again.`, false);
                    return;
               }
               currentPexelsImagePage = 1;
               continue;
            }


            for (const photo of data.photos) {
                if (!usedImageIds.has(photo.id)) {
                    imageUrl = photo.src.large; // Or 'original', 'medium', etc.
                    imageAlt = photo.alt || "Image from Pexels";
                    usedImageIds.add(photo.id);
                    break; // Found a valid, unused image.
                }
            }
             if (!imageUrl) currentPexelsImagePage++;

            if (data.next_page === undefined && !imageUrl) {
                addMessage(`No images found for "${query}". Try again.`, false);
                return;
            }
        }

        const messageDiv = document.createElement('div');
        messageDiv.classList.add('flex', 'mb-2', 'justify-start', 'ai-message-container');

        const avatarImg = document.createElement('img');
        avatarImg.src = botAvatarUrl;
        avatarImg.alt = "Bot Avatar";
        avatarImg.classList.add('avatar');
        messageDiv.appendChild(avatarImg);


        const imageContainer = document.createElement('div');
        imageContainer.classList.add('ai-response');

        const imgElement = document.createElement('img');
        imgElement.src = imageUrl;
        imgElement.alt = imageAlt;
        imgElement.classList.add('generated-image');
        imgElement.style.maxWidth = '100%';
        imgElement.style.height = 'auto';
        imgElement.onerror = () => {
            addMessage(`Error loading image for "${query}".  Please try a different query.`, false);
        };

        imageContainer.appendChild(imgElement);

        // Add description below the image
        const description = document.createElement('div');
        description.classList.add('ai-image-description'); // Added a class for styling
        description.textContent = `Here's an image based on "${query}".`; // Customize as needed
        imageContainer.appendChild(description);


        messageDiv.appendChild(imageContainer);
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;


    } catch (error) {
        console.error("Error searching Pexels images:", error);
        addMessage(`Failed to search for images: ${error.message}. Please try again.`, false);
    } finally {
        removeThinkingIndicator();
    }
}


// Function to call the second VectorShift API
async function callSecondVectorShiftAPI(messageToSend) {
    try {
        const apiUrl = "https://api.vectorshift.ai/api/chatbots/run";
        const requestBody = {
            input: messageToSend,
            chatbot_name: "hjuo",  // Directly use "zay"
            username: "upa_as45",  // Directly use "pagirl_67"
            conversation_id: conversationId,
        };
        const response = await fetch(apiUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Api-Key": secondVectorShiftApiKey,  // Use the SECONDARY API KEY Here
            },
            body: JSON.stringify(requestBody),
        });

        if (!response.ok) {
            const errorData = await response.json();
            console.error("Second VectorShift API Error:", response.status, errorData);
            throw new Error(`Second VectorShift API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
        }

        const data = await response.json();
        console.log("Second VectorShift API Response:", data);

        if (data.output) {
            removeThinkingIndicator(); // Hide thinking indicator IMMEDIATELY
            addMessage(data.output, false);
        } else {
            removeThinkingIndicator(); // Hide thinking indicator in case of no output
            addMessage("Second API call successful, but no output was received.", false);
        }
    } catch (error) {
        removeThinkingIndicator();  // Hide thinking in case of an error
        console.error("Error calling second VectorShift API:", error);
        addMessage(`Error calling second API: ${error.message}`, false);
    }
}

// Modified sendButton event listener - now handles the logic based on the useSecondApi flag
sendButton.addEventListener('click', async () => {
    const userMessage = userInput.value;
    userInput.value = '';
    const trimmedMessage = userMessage.trim();

    if (trimmedMessage !== '') {
        addMessage(trimmedMessage, true); // Add the user message

        const lowerCaseMessage = trimmedMessage.toLowerCase();

        try {
              if (lowerCaseMessage.startsWith("search video of")) {
                const videoPrompt = trimmedMessage.substring("search video of".length).trim();
                if (videoPrompt) {
                    await searchPexelsVideos(videoPrompt);
                    return; // Exit after searching for video
                } else {
                    removeThinkingIndicator();
                    addMessage("Please provide a valid prompt after 'search video of'.", false);
                    return; // Exit after handling invalid prompt
                }
            } else if (lowerCaseMessage.startsWith("search image of")) {
                const imagePrompt = trimmedMessage.substring("search image of".length).trim();
                if (imagePrompt) {
                   await searchPexelsImages(imagePrompt);
                    return; // IMPORTANT: Exit after processing the image search
                } else {
                    removeThinkingIndicator();
                    addMessage("Please provide a valid prompt after 'search image of'.", false);
                    return;
                }
            }
        } catch (error) {
            removeThinkingIndicator();
            console.error("An error occurred:", error);
        }


           // Check for "Generate image of"
        if (lowerCaseMessage.startsWith("generate image of")) {
            showThinkingIndicator();  //Show thinking indicator.

            // Create the iframe response.
            addMessage("", false, null, "https://app.vectorshift.ai/forms/embedded/67d941ab7e6f30aec4f025a7");
            removeThinkingIndicator();
            return;  // Exit early, no need to call other APIs

        }


        if (useSecondApi) {
            // If the 'h' button was clicked, call the second API and show thinking
            showThinkingIndicator();
            callSecondVectorShiftAPI(trimmedMessage); // Pass the user's message
            // DO NOT RESET useSecondApi here.  It stays true until h is pressed AGAIN.
        } else {
            // Otherwise, use the first API (Samar ai)
            showThinkingIndicator();
            chatbotName = "Samar ai";
            username = "da_564";
            const vectorShiftResponse = await getVectorShiftResponse(trimmedMessage);
            if (vectorShiftResponse) {
                removeThinkingIndicator();
                addMessage(vectorShiftResponse, false);
            }
        }
    }
    hideSuggestions();
});


userInput.addEventListener('keypress', async (event) => {
    if (event.key === 'Enter') {
        event.preventDefault();
        await sendButton.click();
    }
});

userInput.addEventListener('paste', (event) => {
    // Hide suggestions when content is pasted into the input field
    hideSuggestions();
});

userInput.addEventListener('keyup', (event) => {
    if (userInput.value.trim() === '') {
        //don't do anything
    } else {
        hideSuggestions();
    }
});

newChatButton.addEventListener('click', () => {
    chatContainer.innerHTML = '';
    conversationId = null;
    errorDiv.classList.add('hidden');
    errorDiv.textContent = '';
    generatedImagesContainer.innerHTML = '';
    removeThinkingIndicator();
    usedVideoIds.clear();
    usedImageIds.clear(); // Clear image IDs on new chat
    currentPexelsVideoPage = 1;
    currentPexelsImagePage = 1;
    // Set back to default (important!)
    chatbotName = "Samar ai";
    username = "da_564";
    useSecondApi = false;  // Also rest the flag
    // Remove the active class from the 'h' button when starting a new chat
    if (hButton) {
        hButton.classList.remove('active');
    }
    loadSuggestions(); // Show suggestions on new chat
});

voiceButton.addEventListener('click', () => {
    window.open("https://www.w3.org", "_blank");
});


// Listener for the 'h' button
// Add/remove the 'active' class for the visual effect
if (hButton) {
    hButton.addEventListener('click', () => {
        useSecondApi = !useSecondApi; // Toggle the flag
        if (useSecondApi) {
            hButton.classList.add('active'); // Add 'active' class for blue ring
            userInput.focus(); // Optionally, focus the input field for immediate typing
        } else {
            hButton.classList.remove('active'); // Remove 'active' class when turning off
        }
    });
}

// Load suggestions on initial page load
loadSuggestions();
hljs.highlightAll();
    </script>
</body>

</html>
